#!/bin/bash

source "${deps}/pkg/common"

src=opus-1.1.3.tar.gz
sha1=7cb1bef20975afbf14a8a43308aed9cb41629f37
url="http://downloads.xiph.org/releases/opus/${src}"

fetch $src $sha1 $url

mkdir ${work}
cd ${work}
tar xf "${files}/${src}"
cd opus-*

./configure \
	--prefix=${prefix} \
	--host=${host_triplet} \
	--disable-shared \
	--disable-doc \
	--disable-extra-programs \
	--disable-silent-rules \
	--enable-intrinsics \
	--enable-rtcd \
	LDFLAGS="-L${prefix}/lib ${LDFLAGS}" \
	CPPFLAGS="-I${prefix}/include"

make ${MAKEFLAGS} install

cat >> ${prefix}/deps.cmake << EOF
set(Opus_INCLUDE_DIR "${prefix}/include/opus" CACHE PATH "")
set(Opus_LIBRARY "${prefix}/lib/libopus.a" CACHE FILEPATH "")
EOF

cd "${deps}"; rm -rf "${work}"
