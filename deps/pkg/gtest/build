#!/bin/bash

source "${deps}/pkg/common"

src=gtest-1.7.0.zip
sha1=f85f6d2481e2c6c4a18539e391aa4ea8ab0394af
url="https://googletest.googlecode.com/files/${src}"

fetch $src $sha1 $url

mkdir ${work}
cd ${work}
unzip "${files}/${src}"
cd gtest-*

install -d -m 755 ${prefix}/lib
install -d -m 755 ${prefix}/include

${CXX} -isystem include -I. -pthread -c src/gtest-all.cc
${CXX} -isystem include -I. -pthread -c src/gtest_main.cc

${AR} -rv ${prefix}/lib/libgtest.a gtest-all.o
${AR} -rv ${prefix}/lib/libgtest_main.a gtest_main.o

cp -R include/gtest ${prefix}/include
chmod -R a+rX ${prefix}/include/gtest

cat >> ${prefix}/deps.cmake << EOF
set(GTEST_INCLUDE_DIRS "${prefix}/include" CACHE PATH "")
set(GTEST_LIBRARIES "${prefix}/lib/libgtest.a" CACHE FILEPATH "")
set(GTEST_MAIN_LIBRARY "${prefix}/lib/libgtest_main.a" CACHE FILEPATH "")
EOF

cd "${deps}"; rm -rf "${work}"
