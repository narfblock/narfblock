#!/bin/bash
# generate CMake toolchain file for host architecture
# based on http://www.cmake.org/Wiki/CmakeMingw

source "${deps}/pkg/common"

mkdir ${work}
cd ${work}

mkdir -p "${prefix}"

rootpath="${prefix}"
if [ "x${MSYSTEM-}" = "xMINGW32" ]; then
	# generate a path that will work with native CMake
	rootpath=$(cd "${prefix}"; pwd -W)
fi

case ${host_triplet} in
*mingw*)
	sysname=Windows
	;;
*linux*)
	sysname=Linux
	;;
*)
	echo "ERROR: unknown system type"
	exit 1
	;;
esac

toolchain=${prefix}/cmake-toolchain

cat <<EOF >${toolchain}
# Toolchain file for cross compilation with CMake
# THIS FILE IS AUTOMATICALLY GENERATED

SET(CMAKE_SYSTEM_NAME ${sysname})
SET(CMAKE_SYSTEM_PROCESSOR ${arch})

SET(CMAKE_C_COMPILER ${CC})
SET(CMAKE_CXX_COMPILER ${CXX})

SET(CMAKE_FIND_ROOT_PATH ${rootpath})

SET(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
SET(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
SET(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)
EOF

if [ "x${WINDRES-}" != x ]; then
	echo "SET(CMAKE_RC_COMPILER ${WINDRES})" >> ${toolchain}
fi

cd "${deps}"; rm -rf "${work}"
