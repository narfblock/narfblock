#!/bin/bash

source "${deps}/pkg/common"

src=glew-1.10.0.tgz
sha1=f41b45ca4a630ad1d00b8b87c5f493781a380300
url="http://download.sourceforge.net/glew/${src}"

fetch $src $sha1 $url

mkdir ${work}
cd ${work}
tar xf "${files}/${src}"
cd glew-*

sed \
	-e "s/i586-mingw32msvc-gcc/${CC}/g" \
	-e "s/i586-mingw32msvc-ld/${LD}/g" \
	-e "s/GLEW_BUILD/GLEW_STATIC/g" \
	< config/Makefile.linux-mingw32 > config/Makefile.custom

# don't build DLL
sed \
	-e 's/lib lib\/$(LIB.SHARED)/lib/' \
	< Makefile > Makefile.custom

echo "AR = ${AR}" >> config/Makefile.custom
echo "STRIP = ${STRIP}" >> config/Makefile.custom

SYSTEM=custom GLEW_DEST=${prefix} make -f Makefile.custom ${make_flags} \
	CFLAGS="${CFLAGS} -Iinclude" \
	LDFLAGS.EXTRA="${LDFLAGS_NOWL}" \
	glew.lib \
	install.include \
	install.pkgconfig

# install the static lib
install -c -m 644 lib/libglew32.a ${prefix}/lib/

cd "${deps}"; rm -rf "${work}"
